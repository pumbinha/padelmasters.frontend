---
import Enroll from "@/components/ui/Enroll.tsx";
import Leave from "@/components/ui/Leave.tsx";
import { getStatusClass } from "@/components/ui/utils.tsx";
import { TranslationKey } from "@/i18n/ui";
import { useTranslations } from "@/i18n/utils";
import Layout from "@/layouts/Layout.astro";
import { type ChampionshipDto } from "@/services/api";
import { getApi, getFormattedDate, getRequestParams } from "@/services/utils";
import { getSession } from "auth-astro/server";
const t = useTranslations(Astro.url);

const { id } = Astro.params;

const session = await getSession(Astro.request);

const api = getApi();

let championship: ChampionshipDto = {};

try {
	if (!id) {
		Astro.redirect("/championships/not-found");
	}

	const championshipResponse =
		await api.api.padelmastersApiDomainEndpointsChampionshipsGetChampionship(
			id || "",
			getRequestParams(session)
		);

	if (championshipResponse.ok) {
		console.log(championshipResponse.data);
		championship = championshipResponse.data.Championship || {};
	} else {
		// 404
		Astro.redirect("/championships/not-found");
	}
} catch (e) {
	console.error(e);
}
---

<Layout title="Padel Masters - Championship">
	<section class="w-full pt-2 md:pt-2 lg:pt-2">
		<div class="overflow-hidden rounded-lg bg-background shadow-md">
			<div class="p-4">
				<h2 class="mb-2 text-xl font-bold">
					{championship.Name}
				</h2>
				<p class="mb-4 text-muted-foreground">{championship.Description}</p>
				<div class="mb-4 flex items-center justify-between">
					<div>
						<span class="font-medium">{t(TranslationKey.ChampionshipsStartDate)}:</span>{" "}
						{getFormattedDate(championship.StartDate)}
					</div>
					<div>
						<span class="font-medium">{t(TranslationKey.ChampionshipsEndDate)}:</span>{" "}
						{getFormattedDate(championship.EndDate)}
					</div>
				</div>
				<div class="flex items-center justify-between">
					<span
						class={`rounded-full px-2 py-1 text-xs font-medium ${getStatusClass(championship.Status)}`}
					>
						{championship.Status}
					</span>
				</div>
			</div>
			<div class="w-full rounded-lg bg-background md:w-auto">
				<Enroll client:load championshipId={id || ""} , text={t(TranslationKey.ActionEnroll)} />
				<Leave client:load championshipId={id || ""} , text={t(TranslationKey.ActionLeave)} />
			</div>
		</div>
		<div class="p-12">
			<a
				href={`/championships/${id}/A`}
				class="text-m rounded-md bg-vivid-800 px-6 py-2 text-primary-foreground transition-colors hover:bg-vivid-900"
			>
				League Standings (temp)
			</a>
		</div>
	</section>
</Layout>
